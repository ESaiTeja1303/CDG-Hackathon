<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>E‑Commerce — Live Deals Demo</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{font-family:'Inter',system-ui,-apple-system,'Segoe UI',Roboto,Arial,sans-serif;line-height:1.5;color:#1a1a1a;background:linear-gradient(180deg,#e0e7ff 0%,#f8fafc 60%);overflow-x:hidden}
    .wrap{max-width:1240px;margin:32px auto;padding:24px}
    header{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;gap:16px;padding:16px;background:#ffffff;border-radius:16px;box-shadow:0 8px 24px rgba(15,23,42,.08);animation:slideIn 0.5s ease-out}
    .brand{display:flex;align-items:center;gap:14px;flex:1}
    .logo{width:56px;height:56px;border-radius:16px;background:linear-gradient(135deg,#6366f1,#06b6d4);display:grid;place-items:center;color:white;font-weight:800;font-size:1.5rem;box-shadow:0 6px 20px rgba(99,102,241,.2);transition:transform 0.3s ease}
    .logo:hover{transform:scale(1.05)}
    h1{font-size:1.25rem;font-weight:700;letter-spacing:-0.02em}
    p.sub{color:#64748b;font-size:0.95rem;font-weight:400}
    .controls{display:flex;flex-wrap:wrap;gap:12px;align-items:center}
    .search{display:flex;align-items:center;background:#ffffff;padding:10px 14px;border-radius:12px;box-shadow:0 6px 20px rgba(15,23,42,.06);transition:box-shadow 0.3s ease}
    .search:hover{box-shadow:0 8px 24px rgba(15,23,42,.1)}
    .search svg{transition:transform 0.3s ease}
    .search:hover svg{transform:scale(1.1)}
    .search input{border:none;outline:none;background:transparent;width:200px;max-width:100%;font-size:0.95rem;color:#1a1a1a}
    .search input::placeholder{color:#94a3b8}
    .cart-btn{position:relative;background:linear-gradient(90deg,#4f46e5,#06b6d4);color:#fff;padding:12px 18px;border-radius:12px;border:none;cursor:pointer;font-weight:600;letter-spacing:0.02em;box-shadow:0 6px 20px rgba(79,70,229,.2);transition:transform 0.3s ease,box-shadow 0.3s ease}
    .cart-btn:hover{transform:scale(1.05);box-shadow:0 8px 24px rgba(79,70,229,.3)}
    .cart-count{position:absolute;top:-8px;right:-8px;background:#f43f5e;color:white;border-radius:50%;width:24px;height:24px;font-size:12px;display:grid;place-items:center;font-weight:700}
    .deals{margin-top:24px;background:#ffffff;padding:16px;border-radius:16px;box-shadow:0 10px 30px rgba(15,23,42,.06);animation:fadeInUp 0.6s ease-out}
    .deals-header{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;gap:12px}
    .deal-list{display:flex;gap:16px;margin-top:16px;overflow:auto;padding-bottom:12px;scroll-behavior:smooth}
    .deal{min-width:260px;flex:1;background:linear-gradient(180deg,#ffffff,#f1f5f9);padding:14px;border-radius:14px;border:1px solid rgba(15,23,42,.05);transition:transform 0.3s cubic-bezier(.2,.9,.3,1),box-shadow 0.3s ease}
    .deal:hover{transform:scale(1.03);box-shadow:0 12px 24px rgba(15,23,42,.1)}
    .deal img{width:100%;height:140px;object-fit:cover;border-radius:12px;transition:transform 0.4s ease}
    .deal:hover img{transform:scale(1.02)}
    .badge{display:inline-block;padding:6px 10px;border-radius:999px;font-weight:600;font-size:12px;background:linear-gradient(90deg,#fb7185,#f97316);color:white}
    .countdown{font-weight:700;margin-top:10px;color:#f43f5e;font-size:0.95rem}
    .layout{display:grid;grid-template-columns:280px 1fr;gap:24px;margin-top:24px}
    aside{background:#ffffff;padding:16px;border-radius:16px;box-shadow:0 10px 30px rgba(15,23,42,.06);animation:fadeInUp 0.6s ease-out}
    .filter h3{font-size:1rem;font-weight:600;margin-bottom:10px}
    .categories{display:flex;flex-direction:column;gap:8px}
    .cat{padding:10px;border-radius:10px;cursor:pointer;border:1px solid transparent;transition:background 0.3s ease,border-color 0.3s ease}
    .cat:hover{background:linear-gradient(90deg,#f8fafc,#eff6ff);border-color:rgba(99,102,241,.2)}
    .cat.active{background:linear-gradient(90deg,#e0e7ff,#eff6ff);border-color:#6366f1;font-weight:700}
    .subcat{padding:10px 10px 10px 28px;border-radius:10px;cursor:pointer;border:1px solid transparent;font-size:0.9rem;animation:slideInLeft 0.3s ease-out}
    .subcat:hover{background:linear-gradient(90deg,#f8fafc,#eff6ff);border-color:rgba(99,102,241,.2)}
    .subcat.active{background:linear-gradient(90deg,#e0e7ff,#eff6ff);border-color:#6366f1;font-weight:700}
    .range{display:flex;gap:10px;align-items:center}
    .range input{width:100%;accent-color:#6366f1}
    .products{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:20px;animation:fadeIn 0.5s ease-out}
    .products.loading{opacity:0.5;pointer-events:none}
    .card{background:#ffffff;border-radius:16px;padding:14px;border:1px solid rgba(15,23,42,.05);box-shadow:0 12px 30px rgba(2,6,23,.04);display:flex;flex-direction:column;gap:10px;transition:transform 0.3s ease,box-shadow 0.3s ease}
    .card:hover{transform:translateY(-10px);box-shadow:0 16px 36px rgba(2,6,23,.08)}
    .card img{height:170px;object-fit:cover;border-radius:12px;transition:transform 0.4s ease}
    .card:hover img{transform:scale(1.02)}
    .price{font-weight:800;color:#1a1a1a;font-size:1.1rem}
    .old{color:#94a3b8;text-decoration:line-through;font-size:0.9rem}
    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
    .btn{flex:1;padding:10px 12px;border-radius:12px;border:none;cursor:pointer;font-weight:600;min-width:100px;transition:transform 0.3s ease,box-shadow 0.3s ease}
    .btn.primary{background:linear-gradient(90deg,#06b6d4,#22d3ee);color:#fff}
    .btn.primary:hover{transform:scale(1.05);box-shadow:0 6px 20px rgba(6,182,212,.3)}
    .btn.ghost{background:transparent;border:1px solid rgba(15,23,42,.1);color:#1a1a1a}
    .btn.ghost:hover{transform:scale(1.05);background:linear-gradient(90deg,#f8fafc,#eff6ff)}
    .cart-drawer{position:fixed;right:24px;top:24px;width:400px;max-width:calc(100% - 48px);height:85vh;background:rgba(255,255,255,.95);backdrop-filter:blur(12px);border-radius:16px;padding:16px;box-shadow:0 20px 60px rgba(2,6,23,.25);transform:translateX(110%);transition:transform 0.4s cubic-bezier(.2,.9,.3,1);z-index:100;display:flex;flex-direction:column}
    .cart-drawer.open{transform:translateX(0);animation:slideInRight 0.4s ease-out}
    .cart-items{overflow:auto;margin-top:12px}
    .cart-item{display:flex;gap:12px;align-items:center;padding:12px;border-radius:12px;border:1px dashed rgba(15,23,42,.05);margin-bottom:10px;transition:transform 0.3s ease}
    .cart-item:hover{transform:translateX(4px)}
    .cart-item img{width:68px;height:68px;object-fit:cover;border-radius:10px}
    .qty{display:flex;gap:8px;align-items:center}
    .muted{color:#64748b;font-size:0.95rem}
    .pill{padding:6px 10px;border-radius:999px;background:#f1f5f9;font-weight:600;color:#1a1a1a}
    .empty{padding:40px;text-align:center;color:#64748b;font-size:1rem}
    footer{margin-top:40px;padding:32px;background:rgba(255,255,255,.95);backdrop-filter:blur(12px);border-radius:16px;box-shadow:0 10px 30px rgba(15,23,42,.06);animation:fadeInUp 0.6s ease-out}
    .footer-content{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:24px;padding:24px 0;border-top:1px solid rgba(15,23,42,.1)}
    .footer-section h4{font-size:1rem;font-weight:600;margin-bottom:12px;color:#1a1a1a}
    .footer-section ul{list-style:none;display:flex;flex-direction:column;gap:8px}
    .footer-section a{color:#64748b;text-decoration:none;font-size:0.95rem;transition:color 0.3s ease}
    .footer-section a:hover{color:#6366f1}
    .social-icons{display:flex;gap:12px}
    .social-icons a{width:40px;height:40px;display:grid;place-items:center;border-radius:50%;background:#f1f5f9;color:#1a1a1a;transition:transform 0.3s ease,background 0.3s ease}
    .social-icons a:hover{transform:scale(1.1);background:linear-gradient(90deg,#6366f1,#06b6d4);color:#fff}
    .newsletter input{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(15,23,42,.1);margin-bottom:12px;font-size:0.95rem;color:#1a1a1a}
    .newsletter input::placeholder{color:#94a3b8}
    .newsletter button{width:100%;padding:10px;border-radius:10px;border:none;background:linear-gradient(90deg,#06b6d4,#22d3ee);color:#fff;font-weight:600;cursor:pointer;transition:transform 0.3s ease}
    .newsletter button:hover{transform:scale(1.05)}
    .footer-bottom{text-align:center;padding-top:24px;border-top:1px solid rgba(15,23,42,.1);color:#64748b;font-size:0.9rem}
    @keyframes slideIn{from{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}
    @keyframes fadeInUp{from{transform:translateY(30px);opacity:0}to{transform:translateY(0);opacity:1}}
    @keyframes slideInLeft{from{transform:translateX(-20px);opacity:0}to{transform:translateX(0);opacity:1}}
    @keyframes slideInRight{from{transform:translateX(20px);opacity:0}to{transform:translateX(0);opacity:1}}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    @media(max-width:900px){.layout{grid-template-columns:1fr}.search input{width:140px}.footer-content{grid-template-columns:1fr}}
    @media(max-width:600px){header{flex-direction:column;align-items:flex-start;padding:12px}.controls{width:100%}.search{flex:1}.search input{width:100%}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">VSS</div>
        <div>
          <h1>E‑Commerce — Live Deals</h1>
          <p class="sub">Shop Smart, Save Big — Your Daily Deals Destination!</p>
        </div>
      </div>

      <div class="controls">
        <div class="search">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.35-4.35" stroke="#64748b" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/><circle cx="11" cy="11" r="6" stroke="#64748b" stroke-width="1.8"/></svg>
          <input id="searchInput" placeholder="Search products, e.g. sneakers" />
        </div>
        <button class="cart-btn" id="openCartBtn">Cart <span class="cart-count" id="cartCount">0</span></button>
      </div>
    </header>

    <section class="deals" aria-label="Deals of the day">
      <div class="deals-header">
        <h3 style="font-size:1.1rem">🔥 Deals of the Day</h3>
        <div class="muted">Limited time offers — updated hourly</div>
      </div>
      <div class="deal-list" id="dealList"></div>
    </section>

    <div class="layout">
      <aside>
        <div class="filter">
          <h3>Categories</h3>
          <div class="categories" id="categories"></div>
        </div>

        <div style="margin-top:16px">
          <h3>Price (max)</h3>
          <div class="range">
            <input id="priceRange" type="range" min="100" max="5000" value="5000" />
            <div class="pill" id="priceLabel">₹5000</div>
          </div>
        </div>

        <div style="margin-top:16px">
          <h3>Sort</h3>
          <select id="sortSelect" style="width:100%;padding:10px;border-radius:10px;border:1px solid rgba(15,23,42,.1);background:#ffffff;color:#1a1a1a">
            <option value="popular">Most popular</option>
            <option value="low">Price: Low → High</option>
            <option value="high">Price: High → Low</option>
            <option value="deal">Deals first</option>
          </select>
        </div>
      </aside>

      <main>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
          <h2 style="font-size:1.15rem;font-weight:700">All Products</h2>
          <div class="muted">Showing <span id="resultsCount">0</span> results</div>
        </div>

        <div class="products" id="productsGrid"></div>
      </main>
    </div>

    <footer>
      <div class="footer-content">
        <div class="footer-section">
          <h4>Shop</h4>
          <ul>
            <li><a href="#">All Products</a></li>
            <li><a href="#">Deals</a></li>
            <li><a href="#">Categories</a></li>
            <li><a href="#">New Arrivals</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h4>Support</h4>
          <ul>
            <li><a href="#">Help Center</a></li>
            <li><a href="#">Returns</a></li>
            <li><a href="#">Shipping</a></li>
            <li><a href="#">Contact Us</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h4>About</h4>
          <ul>
            <li><a href="#">Our Story</a></li>
            <li><a href="#">Careers</a></li>
            <li><a href="#">Press</a></li>
            <li><a href="#">Sustainability</a></li>
          </ul>
        </div>
        <div class="footer-section newsletter">
          <h4>Stay Updated</h4>
          <input type="email" placeholder="Enter your email" />
          <button>Subscribe</button>
          <div class="social-icons">
            <a href="#"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M24 4.6c-.9.4-1.8.7-2.8.8 1-.6 1.8-1.6 2.2-2.7-.9.6-2 1-3.1 1.2-1.9-2-4.6-2.6-7-1.1-1.8 1.1-2.8 3-2.8 5.1 0 .7.1 1.4.3 2-4.1-.2-7.8-2.2-10.3-5.3-.4.7-.7 1.6-.7 2.5 0 1.7.9 3.2 2.2 4.1-.8 0-1.6-.2-2.3-.6v.1c0 2.4 1.7 4.4 3.9 4.8-.4.1-.8.2-1.3.2-.3 0-.6 0-.9-.1.6 1.9 2.4 3.3 4.5 3.3-1.6 1.3-3.7 2.1-5.9 2.1-.4 0-.8 0-1.2-.1 2.1 1.4 4.6 2.2 7.3 2.2 8.7 0 13.5-7.2 13.5-13.5 0-.2 0-.4-.1-.6.9-.7 1.7-1.5 2.3-2.4z"/></svg></a>
            <a href="#"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.04c-5.5 0-9.96 4.46-9.96 9.96 0 5.06 3.73 9.24 8.58 9.9v-7h-2.58v-2.9h2.58v-2.2c0-2.55 1.52-3.96 3.84-3.96 1.1 0 2.04.08 2.32.12v2.7h-1.6c-1.26 0-1.5.6-1.5 1.48v1.94h3l-.4 2.9h-2.6v7c4.85-.66 8.58-4.84 8.58-9.9 0-5.5-4.46-9.96-9.96-9.96z"/></svg></a>
            <a href="#"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2c5.52 0 10 4.48 10 10s-4.48 10-10 10S2 17.52 2 12 6.48 2 12 2zm0 2c-4.42 0-8 3.58-8 8s3.58 8 8 8 8-3.58 8-8-3.58-8-8-8zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 2c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1z"/></svg></a>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        &copy; 2025 E-Commerce Demo. All rights reserved.
      </div>
    </footer>
  </div>

  <!-- Cart Drawer -->
  <div class="cart-drawer" id="cartDrawer" aria-hidden="true">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3 style="font-weight:700">Your Cart</h3>
      <div>
        <button id="clearCartBtn" class="btn ghost" style="margin-right:10px">Clear</button>
        <button id="closeCartBtn" class="btn">Close</button>
      </div>
    </div>
    <div class="cart-items" id="cartItems"></div>
    <div style="margin-top:auto;border-top:1px solid rgba(15,23,42,.1);padding-top:16px;display:flex;justify-content:space-between;align-items:center">
      <div>
        <div class="muted">Total</div>
        <div style="font-weight:900;font-size:1.2rem" id="cartTotal">₹0</div>
      </div>
      <button id="checkoutBtn" class="btn primary">Checkout</button>
    </div>
  </div>

  <script>
    /* ====== Sample products data ====== */
    const products = [
      {id:1,title:' Nike AirRunner Sneakers',category:'Shoes',price:2999,old:3999,img:'./assets/Footwear/f1.png',deal:true,dealEnds:Date.now()+6e5},
      {id:2,title:'Men\'s Comfy Hoodie',category:'Clothing',subcategory:'Men',price:1299,old:0,img:'https://picsum.photos/id/1011/600/400',deal:false},
      {id:3,title:'Smartwatch Z',category:'Gadgets',price:4999,old:5999,img:'./assets/Gadgets/sm.png',deal:true,dealEnds:Date.now()+36e5},
      {id:4,title:'Classic Watch',category:'Gadgets',price:2499,old:2999,img:'./assets/Gadgets/cw.png',deal:false},
      {id:5,title:'Leather Wallet',category:'Accessories',price:499,old:799,img:'./assets/Accessories/lw.png',deal:true,dealEnds:Date.now()+9e5},
      {id:6,title:'Running Socks (3 pack)',category:'Accessories',price:299,old:0,img:'https://picsum.photos/id/1005/600/400',deal:false},
      {id:7,title:'Women\'s Denim Jacket',category:'Clothing',subcategory:'Women',price:3499,old:3999,img:'./assets/Fashion/Women/W4.png',deal:false},
      {id:8,title:'Noise Cancelling Headphones',category:'Gadgets',price:6999,old:8999,img:'https://picsum.photos/id/180/600/400',deal:true,dealEnds:Date.now()+2e6},
      {id:9,title:'Sunglasses',category:'Accessories',price:899,old:1299,img:'./assets/Accessories/sg.png',deal:false},
      {id:10,title:'Kids\' Graphic Tee',category:'Clothing',subcategory:'Kids',price:799,old:999,img:'https://picsum.photos/id/1020/600/400',deal:false},
      {id:11,title:'Puma Men Shoe',category:'Shoes',price:2499,old:2999,img:'./assets/Footwear/f2.png',deal:false},
      {id:12,title:'Nike Jordans',category:'Shoes',price:2499,old:2999,img:'./assets/Footwear/f3.png',deal:false},
      {id:13,title:'Puma Sneakers',category:'Shoes',price:2499,old:2999,img:'./assets/Footwear/f4.png',deal:false},
      {id:14,title:'Bata',category:'Shoes',price:2499,old:2999,img:'./assets/Footwear/f5.png',deal:false},
      {id:15,title:'Coaachi',category:'Shoes',price:2499,old:2999,img:'./assets/Footwear/f6.png',deal:false},
      {id:16,title:'Women Skechers',category:'Shoes',price:2499,old:2999,img:'./assets/Footwear/f7.png',deal:false},
      {id:17,title:'Women Puma',category:'Shoes',price:2499,old:2999,img:'./assets/Footwear/f8.png',deal:false},
      {id:18,title:'Kids Shoe',category:'Shoes',price:2499,old:2999,img:'./assets/Footwear/f9.png',deal:false},
      {id:19,title:'Kids Girls shoe',category:'Shoes',price:2499,old:2999,img:'./assets/Footwear/f10.png',deal:false},
      {id:20,title:'Women\'s Dress',category:'Clothing',subcategory:'Women',price:3499,old:5000,img:'./assets/Fashion/Women/W1.png',deal:false},
      {id:21,title:'Women\'s Saree',category:'Clothing',subcategory:'Women',price:1499,old:2000,img:'./assets/Fashion/Women/W2.png',deal:false},
      {id:22,title:'Women\'s Banaras Saree',category:'Clothing',subcategory:'Women',price:1499,old:2000,img:'./assets/Fashion/Women/W3.png',deal:true,dealEnds:Date.now()+9e5},

      
      
    ];

    /* ====== App State ====== */
    let state = {query:'',category:'All',subcategory:null,maxPrice:5000,sort:'popular',cart:{}};

    /* ====== Helpers ====== */
    const $ = id=>document.getElementById(id);
    function rup(n){return '₹'+n}

    /* ====== Render categories ====== */
    function renderCategories(){
      const cats = ['All',...new Set(products.map(p=>p.category))];
      const container = $('categories'); container.innerHTML='';
      cats.forEach(c=>{
        const el = document.createElement('div');
        el.className = 'cat' + (c === state.category && !state.subcategory ? ' active' : '');
        el.textContent = c;
        el.onclick = () => {
          state.category = c;
          state.subcategory = null;
          renderCategories();
          renderProducts();
        };
        container.appendChild(el);

        // Render subcategories for Clothing
        if (c === 'Clothing' && state.category === 'Clothing') {
          const subcats = ['Men', 'Women', 'Kids'];
          subcats.forEach(sc => {
            const subEl = document.createElement('div');
            subEl.className = 'subcat' + (sc === state.subcategory ? ' active' : '');
            subEl.textContent = sc;
            subEl.onclick = () => {
              state.category = c;
              state.subcategory = sc;
              renderCategories();
              renderProducts();
            };
            container.appendChild(subEl);
          });
        }
      });
    }

    /* ====== Deals list ====== */
    function renderDeals(){
      const list = $('dealList'); list.innerHTML='';
      const deals = products.filter(p=>p.deal).sort((a,b)=>a.dealEnds-b.dealEnds);
      deals.forEach((d,i)=>{
        const itm=document.createElement('div');itm.className='deal';itm.style.animationDelay=`${i*0.1}s`;
        itm.innerHTML = `
          <img src="${d.img}" alt="${d.title}" />
          <div class="info">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <strong>${d.title}</strong>
              <span class="badge hot">${Math.round((1 - d.price/(d.old||d.price))*100)}% OFF</span>
            </div>
            <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
              <div>
                <div class="price">${rup(d.price)}</div>
                ${d.old?`<div class="old">${rup(d.old)}</div>`:''}
              </div>
            </div>
            <div class="countdown" data-end="${d.dealEnds}">--:--:--</div>
            <div style="margin-top:10px;display:flex;gap:10px">
              <button class="btn primary" onclick="addToCart(${d.id})">Add to cart</button>
              <button class="btn ghost" onclick="viewProduct(${d.id})">View</button>
            </div>
          </div>`;
        list.appendChild(itm);
      })
    }

    /* ====== Countdown updater ====== */
    function updateCountdowns(){
      document.querySelectorAll('[data-end]').forEach(node=>{
        const end = +node.dataset.end;
        const diff = end - Date.now();
        if(diff<=0){ node.textContent='Ended'; }
        else{
          const hrs=Math.floor(diff/36e5); const mins=Math.floor(diff%36e5/6e4); const secs=Math.floor(diff%6e4/1000);
          node.textContent = `${String(hrs).padStart(2,'0')}:${String(mins).padStart(2,'0')}:${String(secs).padStart(2,'0')}`;
        }
      })
    }

    /* ====== Products render & filtering ====== */
    function renderProducts(){
      const grid = $('productsGrid');
      grid.classList.add('loading');
      setTimeout(()=>{grid.classList.remove('loading')},300);
      const q = state.query.toLowerCase();
      let list = products.filter(p=> {
        const matchesCategory = state.category === 'All' || p.category === state.category;
        const matchesSubcategory = state.category !== 'Clothing' || !state.subcategory || p.subcategory === state.subcategory;
        const matchesPrice = p.price <= state.maxPrice;
        const matchesQuery = p.title.toLowerCase().includes(q) || p.category.toLowerCase().includes(q) || (p.subcategory && p.subcategory.toLowerCase().includes(q));
        return matchesCategory && matchesSubcategory && matchesPrice && matchesQuery;
      });
      if(state.sort==='low') list.sort((a,b)=>a.price-b.price);
      if(state.sort==='high') list.sort((a,b)=>b.price-a.price);
      if(state.sort==='deal') list.sort((a,b)=>(b.deal?1:0)-(a.deal?1:0));
      $('resultsCount').textContent = list.length;
      grid.innerHTML='';
      list.forEach((p,i)=>{
        const card = document.createElement('article');card.className='card';card.style.animationDelay=`${i*0.05}s`;
        card.innerHTML = `
          <img src="${p.img}" alt="${p.title}" />
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div><strong>${p.title}</strong><div class="muted" style="font-size:0.95rem">${p.subcategory ? p.subcategory + ' - ' : ''}${p.category}</div></div>
            <div style="text-align:right"><div class="price">${rup(p.price)}</div>${p.old?`<div class="old">${rup(p.old)}</div>`:''}</div>
          </div>
          <div class="actions">
            <button class="btn primary" onclick="addToCart(${p.id})">Add to cart</button>
            <button class="btn ghost" onclick="viewProduct(${p.id})">Details</button>
          </div>
        `;
        grid.appendChild(card);
      })
    }

    /* ====== Cart logic (localStorage) ====== */
    function loadCart(){
      try{state.cart = JSON.parse(localStorage.getItem('ec_cart')||'{}');}catch(e){state.cart={}}; updateCartUI();
    }
    function saveCart(){localStorage.setItem('ec_cart',JSON.stringify(state.cart));updateCartUI();}
    function addToCart(id){state.cart[id] = (state.cart[id]||0)+1; saveCart(); flashCart();}
    function removeFromCart(id){delete state.cart[id]; saveCart();}
    function changeQty(id,delta){state.cart[id]=Math.max(0,(state.cart[id]||0)+delta); if(state.cart[id]===0) removeFromCart(id); saveCart();}
    function clearCart(){state.cart={}; saveCart();}

    function updateCartUI(){
      const items = $('cartItems'); items.innerHTML='';
      const ids = Object.keys(state.cart).map(Number);
      let total=0;let count=0;
      if(ids.length===0){items.innerHTML='<div class="empty">Your cart is empty — add some great deals!</div>'}
      ids.forEach((id,i)=>{
        const product = products.find(p=>p.id===id); const qty=state.cart[id];
        if(!product) return;
        count+=qty; total+=product.price*qty;
        const node = document.createElement('div'); node.className='cart-item';node.style.animationDelay=`${i*0.05}s`;
        node.innerHTML = `
          <img src="${product.img}" />
          <div style="flex:1">
            <div style="display:flex;justify-content:space-between;align-items:center"><strong>${product.title}</strong><div class="price">${rup(product.price*qty)}</div></div>
            <div style="display:flex;align-items:center;justify-content:space-between;margin-top:10px">
              <div class="qty"><button class="btn ghost" onclick="changeQty(${id},-1)">-</button><div style="padding:6px 12px;border-radius:10px">${qty}</div><button class="btn ghost" onclick="changeQty(${id},1)">+</button></div>
              <button class="btn ghost" onclick="removeFromCart(${id})">Remove</button>
            </div>
          </div>
        `;
        items.appendChild(node);
      })
      $('cartCount').textContent = count;
      $('cartTotal').textContent = rup(total);
    }

    function flashCart(){
      const btn = $('openCartBtn'); btn.animate([{transform:'scale(1)'},{transform:'scale(1.1)'},{transform:'scale(1)'}],{duration:300});
    }

    /* ====== Small interactions ====== */
    function viewProduct(id){
      const p = products.find(x=>x.id===id);
      alert(p.title+' — '+rup(p.price)+'\nCategory: '+p.category+(p.subcategory ? '\nSubcategory: '+p.subcategory : ''));
    }

    /* ====== Wire UI ====== */
    $('searchInput').addEventListener('input',e=>{state.query=e.target.value;renderProducts()});
    $('priceRange').addEventListener('input',e=>{state.maxPrice=+e.target.value;$('priceLabel').textContent=rup(state.maxPrice);renderProducts()});
    $('sortSelect').addEventListener('change',e=>{state.sort=e.target.value;renderProducts()});

    $('openCartBtn').addEventListener('click',()=>{$('cartDrawer').classList.add('open');$('cartDrawer').setAttribute('aria-hidden','false')});
    $('closeCartBtn').addEventListener('click',()=>{$('cartDrawer').classList.remove('open');$('cartDrawer').setAttribute('aria-hidden','true')});
    $('clearCartBtn').addEventListener('click',()=>{if(confirm('Clear cart?')) clearCart()});
    $('checkoutBtn').addEventListener('click',()=>{if(Object.keys(state.cart).length===0)return alert('Cart is empty');alert('Checkout simulation — total: '+$('cartTotal').textContent);clearCart()});

    /* ====== Init ====== */
    function init(){
      renderCategories(); renderDeals(); renderProducts(); loadCart(); updateCountdowns(); setInterval(updateCountdowns,1000);
    }
    init();

    // Expose some functions for inline handlers
    window.addToCart = addToCart; window.viewProduct = viewProduct; window.changeQty = changeQty; window.removeFromCart = removeFromCart; window.clearCart = clearCart;
  </script>
</body>
</html>